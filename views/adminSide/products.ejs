<%- include("sidebar.ejs") %>
<!-- Page Content -->
<%- include("header.ejs")%>

<!-- Products Section -->
<section id="products" class="content-section active">
  <div class="container">
    <h2>Add New Product</h2>
    <form id="addProductForm" enctype="multipart/form-data">
      <!-- Product Name -->
      <div class="form-group">
        <label for="productName">Product Name</label>
        <input
          type="text"
          id="productName"
          name="name"
          placeholder="Enter product name"
          required
        />
      </div>

      <!-- Product Price -->
      <div class="form-group">
        <label for="productPrice">Product Price ($)</label>
        <input
          type="number"
          id="productPrice"
          name="price"
          placeholder="Enter product price"
          step="0.01"
          min="0"
          required
        />
      </div>

      <!-- Product Category -->
      <div class="form-group">
        <label for="productCategory">Category</label>
        <select id="productCategory" name="category" required>
          <% if (categories.length > 0){ %>
          <option selected disabled>Select category</option>
          <% categories.forEach((category,index)=>{ %>
          <option value="<%= category.name  %>"><%= category.name %></option>

          <% }) %> <% }else{ %>
          <option selected disabled>NO categories available</option>
          <% }%>
          <!-- <option value="clothing">Clothing</option>
          <option value="home">Home Appliances</option>
          <option value="books">Books</option> -->
        </select>
      </div>

      <!-- Product Image Upload -->
      <div class="form-group">
        <label for="productImage">Upload Product Image</label>
        <input
          type="file"
          id="productImage"
          name="image"
          accept="image/*"
          required
        />
      </div>

      <!-- Product Description -->
      <div class="form-group">
        <label for="productDescription">Description</label>
        <textarea
          id="productDescription"
          name="description"
          rows="4"
          placeholder="Enter product description"
          required
        ></textarea>
      </div>

      <!-- Stock Quantity -->
      <div class="form-group">
        <label for="productStock">Stock Quantity</label>
        <input
          type="number"
          id="productStock"
          name="stock"
          placeholder="Enter stock quantity"
          min="0"
          required
        />
      </div>

      <!-- Error message -->
      <div>   
        <p style="display: none; color: red" id="errorMsg">
          Category already exists
        </p>
      </div>
      <!-- Submit Button -->
      <button type="submit">Add Product</button>
    </form>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("addProductForm");
    form.addEventListener("submit", (event) => {
      event.preventDefault();

      const productInputName = document
        .getElementById("productName")
        .value.trim();
      const productPrice = document.getElementById("productPrice").value.trim();
      const productCategory = document.getElementById("productCategory").value;
      const productImage = document.getElementById("productImage").files[0];
      const productDescription = document
        .getElementById("productDescription")
        .value.trim();
      const productStockQuantity =
        document.getElementById("productStock").value;

      if (
        !productInputName ||
        !productPrice ||
        !productCategory ||
        !productImage ||
        !productDescription ||
        !productStockQuantity
      ) {
        document.getElementById("errorMsg").style.display = "block";
        alert("Please fill out all required fields and upload an image.");
        return;
      }

      const formData = new FormData();
      formData.append("name", productName);
      formData.append("price", productPrice);
      formData.append("category", productCategory);
      formData.append("image", productImage); // File is appended here
      formData.append("description", productDescription);
      formData.append("stock", productStockQuantity);

      console.log("axios started");
      axios
        .post("/api/admin/addProduct", formData, {
          headers: {
            "Content-Type": "multipart/form-data",
          },
        })
        .then((response) => {
          if (response.status === 200) {
            swal.fire({
              icon: "success",
              title: "success!",
              text: response.data.message,
            });
          }
        })
        .catch((err) => {
          console.error(err.message);
          swal.fire({
            icon: "error",
            title: "Error",
            text: "There was an error while adding the product.",
          })
        })
    });
  });
</script>

<%- include("footer.ejs")%>
